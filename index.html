<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ren'Py Web Tools | Unrpa & Unrpyc</title>
    <style>
        :root {
            --primary: #4A90E2;
            --bg-color: #121212;
            --card-bg: #1E1E1E;
            --text-main: #FFFFFF;
            --text-muted: #A0A0A0;
            --hover-color: #357ABD;
            --error-color: #E74C3C;
            --success-color: #2ECC71;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        header { text-align: center; padding: 3rem 1rem 2rem; }
        header h1 { margin: 0; font-size: 2.5rem; color: var(--primary); }
        header p { color: var(--text-muted); font-size: 1.1rem; margin-top: 0.5rem; }

        .tools-container {
            display: flex; flex-wrap: wrap; gap: 2rem; justify-content: center;
            padding: 2rem; max-width: 900px; width: 100%;
        }

        .tool-card {
            background-color: var(--card-bg); border-radius: 12px; padding: 2rem;
            flex: 1 1 300px; box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            text-align: center; border: 1px solid #333;
        }

        .tool-icon { font-size: 3rem; margin-bottom: 1rem; }
        .tool-card h2 { margin: 0 0 1rem; font-size: 1.5rem; }
        .tool-card p { color: var(--text-muted); font-size: 0.95rem; margin-bottom: 1.5rem; }

        .file-input-wrapper { margin-bottom: 1.5rem; }
        input[type="file"] { display: none; }
        
        .file-label {
            background-color: #2D2D2D; border: 2px dashed #555; padding: 1rem;
            display: block; border-radius: 8px; cursor: pointer; color: var(--text-muted);
        }
        .file-label:hover { border-color: var(--primary); color: var(--text-main); }

        .btn {
            background-color: var(--primary); color: white; border: none;
            padding: 0.8rem 2rem; border-radius: 6px; font-size: 1rem;
            font-weight: bold; cursor: pointer; width: 100%;
        }
        .btn:disabled { background-color: #555; cursor: not-allowed; }

        /* Progress Bar */
        .progress-container {
            width: 100%; background-color: #333; border-radius: 6px;
            margin-top: 1rem; height: 20px; display: none; overflow: hidden;
        }
        .progress-bar {
            height: 100%; width: 0%; background-color: var(--primary); color: white;
            font-size: 0.75rem; font-weight: bold; line-height: 20px; text-align: center;
        }

        /* Alert */
        .alert-message {
            margin-top: 1rem; padding: 0.8rem; border-radius: 6px;
            font-size: 0.9rem; display: none; font-weight: bold;
        }
        .alert-error { background-color: rgba(231, 76, 60, 0.2); color: var(--error-color); border: 1px solid var(--error-color); }
        .alert-success { background-color: rgba(46, 204, 113, 0.2); color: var(--success-color); border: 1px solid var(--success-color); }

        /* Download Area */
        .download-area {
            margin-top: 1rem; padding: 1rem; background-color: #1A251E;
            border: 1px solid var(--success-color); border-radius: 8px;
            display: none; flex-direction: column; gap: 0.8rem;
        }
        .download-area p { margin: 0; color: var(--success-color); font-weight: bold; }
        
        .btn-download {
            background-color: var(--success-color); color: #121212; border: none;
            padding: 0.8rem; border-radius: 6px; font-weight: bold; font-size: 0.95rem;
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem;
        }
        .btn-download:hover { background-color: #27AE60; color: white; }

        footer { margin-top: auto; padding: 2rem; color: var(--text-muted); font-size: 0.9rem; }
    </style>
</head>
<body>

    <header>
        <h1>Ren'Py Web Tools</h1>
        <p>Ekstrak dan Dekompilasi file game Ren'Py dengan mudah</p>
    </header>

    <div class="tools-container">
        <div class="tool-card">
            <div class="tool-icon">üì¶</div>
            <h2>Unrpa Extractor</h2>
            <p>Ekstrak aset game dari arsip <strong>.rpa</strong>.</p>
            
            <div class="file-input-wrapper">
                <label for="rpa-upload" class="file-label" id="rpa-label">Pilih File .rpa</label>
                <input type="file" id="rpa-upload" accept=".rpa" onchange="tanganiFileTerpilih('rpa')">
            </div>

            <button class="btn" id="btn-rpa" onclick="mulaiProses('rpa')">Ekstrak Archive</button>

            <div class="progress-container" id="rpa-progress"><div class="progress-bar" id="rpa-bar">0%</div></div>
            <div class="alert-message" id="rpa-msg"></div>

            <div class="download-area" id="rpa-download-area">
                <p>‚úÖ Ekstraksi Selesai!</p>
                <button class="btn-download" id="btn-dl-rpa" onclick="simulasiDownload('rpa')">
                    ‚¨áÔ∏è Download File
                </button>
            </div>
        </div>

        <div class="tool-card">
            <div class="tool-icon">üìú</div>
            <h2>Unrpyc Decompiler</h2>
            <p>Dekompilasi script <strong>.rpyc</strong> menjadi <strong>.rpy</strong>.</p>
            
            <div class="file-input-wrapper">
                <label for="rpyc-upload" class="file-label" id="rpyc-label">Pilih File .rpyc</label>
                <input type="file" id="rpyc-upload" accept=".rpyc" onchange="tanganiFileTerpilih('rpyc')">
            </div>

            <button class="btn" id="btn-rpyc" onclick="mulaiProses('rpyc')">Decompile Script</button>

            <div class="progress-container" id="rpyc-progress"><div class="progress-bar" id="rpyc-bar">0%</div></div>
            <div class="alert-message" id="rpyc-msg"></div>

            <div class="download-area" id="rpyc-download-area">
                <p>‚úÖ Dekompilasi Selesai!</p>
                <button class="btn-download" id="btn-dl-rpyc" onclick="simulasiDownload('rpyc')">
                    ‚¨áÔ∏è Download File
                </button>
            </div>
        </div>
    </div>

    <footer>&copy; 2026 Ren'Py Tools Dashboard.</footer>

    <script>
        // Objek untuk menyimpan nama file yang sedang aktif agar tidak bocor jadi undefined
        const dataFileAktif = {
            rpa: { namaAsli: "", namaHasil: "" },
            rpyc: { namaAsli: "", namaHasil: "" }
        };

        let daftarInterval = {};

        // Fungsi yang dipanggil saat user memilih file dari folder
        function tanganiFileTerpilih(tipe) {
            const inputElement = document.getElementById(`${tipe}-upload`);
            const labelElement = document.getElementById(`${tipe}-label`);
            
            // Cek apakah user benar-benar memilih file (tidak meng-cancel dialog)
            if (inputElement && inputElement.files && inputElement.files.length > 0) {
                // Ambil nama file dengan fallback aman
                let namaFile = inputElement.files.name;
                if (!namaFile || namaFile === "undefined") {
                    namaFile = "file_tidak_diketahui." + tipe;
                }

                // Simpan ke memori global
                dataFileAktif[tipe].namaAsli = namaFile;
                
                // Ubah tampilan label
                labelElement.innerHTML = `File terpilih:<br><strong style="color: var(--primary);">${namaFile}</strong>`;
                labelElement.style.borderColor = "var(--primary)";
            } else {
                // Jika user batal memilih, reset semuanya
                labelElement.innerHTML = `Pilih File .${tipe}`;
                labelElement.style.borderColor = "#555";
                dataFileAktif[tipe].namaAsli = ""; 
            }
        }

        // Fungsi memunculkan notifikasi merah/hijau
        function tampilkanPesan(tipe, teks, apakahError) {
            const kotakPesan = document.getElementById(`${tipe}-msg`);
            kotakPesan.style.display = "block";
            kotakPesan.innerHTML = teks;
            kotakPesan.className = apakahError ? "alert-message alert-error" : "alert-message alert-success";
        }

        // Fungsi trigger klik tombol download
        function simulasiDownload(tipe) {
            const namaFileHasil = dataFileAktif[tipe].namaHasil || "hasil_download.zip";
            alert(`Mendownload file: ${namaFileHasil}\n\n(Berhasil! Jika web sudah dihubungkan ke server Python, file asli akan terunduh.)`);
        }

        // Fungsi inti saat tombol proses diklik
        function mulaiProses(tipe) {
            // Deklarasi elemen-elemen UI
            const btnProses = document.getElementById(`btn-${tipe}`);
            const areaProgress = document.getElementById(`${tipe}-progress`);
            const barProgress = document.getElementById(`${tipe}-bar`);
            const areaDownload = document.getElementById(`${tipe}-download-area`);
            const btnDownload = document.getElementById(`btn-dl-${tipe}`);
            const kotakPesan = document.getElementById(`${tipe}-msg`);

            // 1. Reset tampilan
            kotakPesan.style.display = "none";
            areaProgress.style.display = "none";
            areaDownload.style.display = "none";
            barProgress.style.width = "0%";
            barProgress.innerHTML = "0%";
            barProgress.style.backgroundColor = "var(--primary)";

            // 2. Cek apakah nama file sudah tersimpan di memori
            const namaAsli = dataFileAktif[tipe].namaAsli;
            if (!namaAsli || namaAsli.trim() === "") {
                tampilkanPesan(tipe, "Error: Harap pilih file terlebih dahulu!", true);
                return;
            }

            // 3. Validasi Ekstensi
            if (!namaAsli.toLowerCase().endsWith(`.${tipe}`)) {
                tampilkanPesan(tipe, `Error: Ekstensi salah! Harap unggah file <strong>.${tipe}</strong>`, true);
                return;
            }

            // 4. Proses Ekstraksi / Dekompilasi Berjalan
            btnProses.disabled = true;
            btnProses.innerHTML = "Memproses...";
            areaProgress.style.display = "block";

            let progress = 0;
            if (daftarInterval[tipe]) clearInterval(daftarInterval[tipe]);

            daftarInterval[tipe] = setInterval(() => {
                progress += 15; // Kecepatan loading
                if (progress > 100) progress = 100;
                
                barProgress.style.width = `${progress}%`;
                barProgress.innerHTML = `${progress}%`;

                // 5. Jika selesai 100%
                if (progress === 100) {
                    clearInterval(daftarInterval[tipe]);
                    btnProses.disabled = false;
                    btnProses.innerHTML = tipe === 'rpa' ? "Ekstrak Archive" : "Decompile Script";
                    barProgress.style.backgroundColor = "var(--success-color)";
                    
                    tampilkanPesan(tipe, `Berhasil memproses <strong>${namaAsli}</strong>!`, false);
                    areaDownload.style.display = "flex";

                    // Atur nama file hasil secara presisi
                    if (tipe === 'rpyc') {
                        // ganti ujung string .rpyc atau .RPYC menjadi .rpy
                        dataFileAktif.rpyc.namaHasil = namaAsli.replace(/\.rpyc$/i, '.rpy');
                        btnDownload.innerHTML = `‚¨áÔ∏è Download <strong>${dataFileAktif.rpyc.namaHasil}</strong>`;
                    } 
                    else if (tipe === 'rpa') {
                        // ganti ujung string .rpa atau .RPA menjadi .zip
                        dataFileAktif.rpa.namaHasil = namaAsli.replace(/\.rpa$/i, '.zip');
                        btnDownload.innerHTML = `‚¨áÔ∏è Download <strong>${dataFileAktif.rpa.namaHasil}</strong>`;
                    }
                }
            }, 300);
        }
    </script>
</body>
</html>
